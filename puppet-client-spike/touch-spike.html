<!DOCTYPE html>
<html>

<head>
  <title>Touch spike</title>
  <style>
    div#canvas {
      border: 1px solid blue;

      }
  </style>
  <script>
    var canvas;
    var context;
    var output;
    var force = 1;

    function init() {
      output = document.getElementById("output");
      output.innerText = "Ready."

      canvas = document.getElementById("canvas");
      context = canvas.getContext("2d");
      canvas.addEventListener('touchstart', handleTouchStart, false);
      canvas.addEventListener('touchmove', handleTouchMove, false);
      canvas.addEventListener('touchforcechange', handleTouchForceChange, false);
      canvas.addEventListener('webkitmouseforcechange', handleTouchForceChange, false);
//      document.addEventListener('touchstart', handleTouchStart, false);
//      document.addEventListener('touchmove', handleTouchMove, false);
      }

    function  hanldeTouchForceChange(touchEvent) {
      var touch = touchEvent.touches[0];
      var f = touch.webkitForce;
      output.innerText = "Force: "+f;
      }


    function handleTouchStart(touchEvent) {
      touchEvent.preventDefault();
      var touch = touchEvent.touches[0];
      var clientRectangle = touchEvent.target.getBoundingClientRect();
      var x = touch.clientX - clientRectangle.left;
      var y = touch.clientY - clientRectangle.top;
      var f = 10*touch.force;
      //output.innerText = "Force: "+f;
      // output.innerText += "S"+x+";"+y;
      context.fillStyle = "red";
      context.fillRect(x - f, y - f, 2*f + 1, 2*f + 1);
      }

    function handleTouchMove(touchEvent) {
      touchEvent.preventDefault();
      var touch = touchEvent.touches[0];
      var clientRectangle = touchEvent.target.getBoundingClientRect();
      var x = touch.clientX - clientRectangle.left;
      var y = touch.clientY - clientRectangle.top;
      var f = 10*touch.force;
      //output.innerText = "Force: "+f;
      //output.innerText += "M";
      context.fillStyle = "green";
      context.fillRect(x - f, y - f, 2*f + 1, 2*f + 1);
      }
  </script>
</head>

<body onload="init();">
  <h1>Touch spike</h1>
  <canvas style="border: 1px solid red;" id="canvas" width="300" height="300">
    No canvas support, choose other browser
  </canvas>
  <div id="output" rows="10">
    Logging goes here.
  </div>
</body>
