<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script>
      
      $(document).ready(init);
    
      function Set(target, color) {
        this.cmd = "set";
        this.target = target;
        this.color = color;  
        }
      
      function Wait(ms) {
        this.inst = "wait";
        this.ms = ms;
        }
        
        function Target(arrays, pixels) {
          if (pixels == null) pixels = "all";
          this.arrays = arrays;
          this.pixels = pixels;
        }
/*
      var scripts = [
        [
        	{
        		"cmd": "set",
        		"target": "all",
        		"color": "000000"
        	},
        	{
        		"inst": "wait",
        		"ms": 1000
        	},
        	{
        		"cmd": "set",
        		"target": {
        		   "arrays": [ "scene", "back" ],
        		   "pixels": "all"
        		},
        		"color": "ff0000"
        	},
        	{
        		"inst": "wait",
        		"ms": 2000
        	},
            {
        		"cmd": "set",
        		"target": {
        		   "arrays": [ "mid", "front" ],
        		   "pixels": "all"
        		},
        		"color": "00ff00"
        	}	
        ]
        
        ]
  */
      function init() {
        console.log("ready!");
        }
    
        var error;
        
        var smallsc = [new Set("all", "0000ff"), new Wait(2000), new Set(new Target(["scene","mid"]), "ffcc00")];
        
      function allBlue(button) {
        alert(JSON.stringify(smallsc));
        button.style.color = "#ff0000";
        $.post({
          url: "/api",
          dataType: "json",
          data: JSON.stringify(smallsc),
          success: function(data) { button.style.color = "#00ff00"; }
          })
        .fail(function(msg) { error = msg; })
        }
      function allRed(button) {
        button.style.color = "#ff0000";
        $.post({
          url: "/api",
          dataType: "json",
          data: JSON.stringify([new Set("all", "ff0000")]),
          success: function(data) { button.style.color = "#00ff00"; }
          })
        .fail(function(msg) { error = msg; })
        }
      function doAction(button, action) {
        $.post({
          url: "/api",
          dataType: "json",
          data: JSON.stringify(action),
          success: function(data) {  }
          })
        .fail(function(msg) { error = msg; })
        }
      var strandColor = [new Set('all', 'ffccaa')]
      var seaColor = [
        new Set(new Target("scene", 'all'), 'aaaaff'),
        new Set(new Target('back', "all"), '000022'),
        new Set(new Target('mid', "all"), '0000aa'),
        new Set(new Target('front', "all"), '2222ff'),
        new Set(new Target('side', "all"), '8888ff')
        ];
     var blink = [
      { "cmd": "set"
        , "color": "0"
        , "target": new Target("all", "all")
      }
      ,
        { "cmd": "set"
        , "color": "ffffff"
        , "target":  new Target("side", "left")
        }
      , { "inst": "wait"
        , "ms": 50
        }
      , { "cmd": "set"
        , "color": "000000"
        , "target": new Target("side", "all")
        }
      , { "inst": "wait"
        , "ms": 500
        }
      , { "cmd": "set"
        , "color": "ffffff"
        , "target": new Target("side", "right")
        }
      , { "inst": "wait"
        , "ms": 200
        }
     ]
     blink = blink.concat(seaColor);

     var dangerColor = [
         new Set("left", "ff0000")
     ]

     var sort = [new Set("all", "0")]
     var action = {
       cmd: "set",
       target: {
         arrays: [],
         pixels: "all"
         },
       color: "000000" 
       }
     function doIt() {
       console.log("doing it?");
       var arrays = [];
       $('input.arrays:checked').each(function() { arrays.push(this.value); });
       action.target.arrays = arrays;
       action.color = document.getElementById("theColor").value.substring(1);
       action.target.pixels = $("input:radio[name = 'pixels']:checked").val();
       // alert(JSON.stringify(action));
       doAction(null, [action]);
       }
    </script>
  </head>
  <body>
    Puppetry!
    <hr/>
    <p><button onclick="doAction(this, strandColor);">Strand</button></p>
    <p><button onclick="doAction(this, seaColor);">Hav</button></p>
    <p><button onclick="doAction(this, blink);">Elaal</button></p>
    <p><button onclick="doAction(this, dangerColor);">Fare</button></p>
    <p><button onclick="doAction(this, sort);">Sort</button></p>
    <p>

    <div name="AwesomeColorForm">
      <input onchange="doIt()" id="theColor" value="#ffffff" name="color" type="color"></input>
      <input class="arrays" checked value="back" type="checkbox">back</input>
      <input class="arrays" checked value="mid" type="checkbox">mid</input>
      <input class="arrays" checked value="front" type="checkbox">front</input>
      <input class="arrays" checked value="side" type="checkbox">side</input>
      <input class="arrays" checked value="scene" type="checkbox">scene</input>
      <input value="left" name="pixels" type="radio"></input> &lt;
      <input value="all" name="pixels" type="radio"  checked></input> &gt;
      <input value="right" name="pixels" type="radio"></input>
      <button onclick="doIt()">Let there be light</button>
    </div>
  </body>
</html>
